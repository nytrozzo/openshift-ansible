---
- name: Ensure required directories are present
  file:
    path: "{{ item }}"
    owner: root
    group: root
    mode: 0755
    state: directory
  with_items:
  - /etc/origin/node/pods
  - /etc/origin/node/certificates
- name: Determine if node already has a dynamic config group
  lineinfile:
    dest: "/etc/sysconfig/{{ openshift_service_type }}-node"
    line: "BOOTSTRAP_CONFIG_NAME="
    regexp: "^BOOTSTRAP_CONFIG_NAME=.+"
  check_mode: yes
  register: existing
- name: Update the sysconfig to group "{{ r_node_dynamic_config_name }}"
  lineinfile:
    dest: "/etc/sysconfig/{{ openshift_service_type }}-node"
    line: "BOOTSTRAP_CONFIG_NAME={{ r_node_dynamic_config_name }}"
    regexp: "^BOOTSTRAP_CONFIG_NAME=.*"
  when: r_node_dynamic_config_force|default(False) or not(existing|changed)
